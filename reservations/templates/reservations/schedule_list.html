{%extends "reservations/main.html"%}
{%block title%}
schedule list
{%endblock%}
{%block content%}
<div class="max-w-6xl mx-auto mt-10  rounded-lg  p-8">
    <!-- Flash Messages -->
    {% if messages %}
    <div class="fixed top-5 right-5 w-1/3 z-50">
        {% for message in messages %}
        <div class="p-4 mb-4 rounded-lg {{ message.tags }} bg-green-100 border-l-4 border-green-600 text-green-700">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Header Section -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold text-gray-800">Schedule List</h2>
        <a href="{% url 'create_schedule' %}" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 shadow-md">
            Add Schedule
        </a>
    </div>

    <!-- Schedule Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full table-auto bg-white rounded-lg shadow-md">
            <thead class="bg-gray-100 text-gray-600 uppercase text-sm font-semibold">
                <tr>
                    <th class="py-3 px-6 text-left">Train</th>
                    <th class="py-3 px-6 text-left">Route</th>
                    <th class="py-3 px-6 text-left">Arrival Time</th>
                    <th class="py-3 px-6 text-left">Departure Time</th>
                    <th class="py-3 px-6 text-left">Actions</th>
                </tr>
            </thead>
            <tbody class="text-gray-700">
                {% for schedule in schedules %}
                <tr class="hover:bg-gray-50 border-b">
                    <td class="py-3 px-6">
                        <a href="{% url 'train_detail' schedule.copyTrain.id %}" class="text-red-600 hover:underline">
                            {{ schedule.copyTrain.trainName }}
                        </a>
                    </td>
                    <td class="py-3 px-6">
                        {{ schedule.route.sourceStation.stationName }} â†’ {{ schedule.route.destinationStation.stationName }}
                    </td>
                    <td class="py-3 px-6">{{ schedule.arrivalTime }}</td>
                    <td class="py-3 px-6">{{ schedule.departureTime }}</td>
                    <td class="py-3 px-6 flex items-center space-x-4">
                        <a href="{% url 'update_schedule' schedule.id %}" class="text-blue-500 hover:underline">
                            Edit
                        </a>
                        <button
                            class="px-3 py-1 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600"
                            onclick="confirmDelete('schedule', {{ schedule.id }})">
                            Delete
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center py-6 text-gray-500">No schedules available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
            <h3 class="text-lg font-semibold text-gray-800">Confirm Deletion</h3>
            <p class="text-gray-600 mt-2">Are you sure you want to delete this schedule?</p>
            <div class="flex justify-end mt-4 space-x-4">
                <button id="cancelDelete" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                    Cancel
                </button>
                <form id="deleteForm" method="POST" action="">
                    {% csrf_token %}
                    <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function confirmDelete(model, modelId) {
        // Show the confirmation modal
        const modal = document.getElementById("confirmationModal");
        modal.classList.remove("hidden");

        // Set the form action dynamically
        const deleteForm = document.getElementById("deleteForm");
        deleteForm.action = `/${model}/delete/${modelId}/`;

        // Hide the modal on cancel
        const cancelButton = document.getElementById("cancelDelete");
        cancelButton.addEventListener("click", () => {
            modal.classList.add("hidden");
        });
    }
</script>

{%endblock%}