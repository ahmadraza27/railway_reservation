{%extends "reservations/main.html"%}
{%block title%}
routelist
{%endblock%}
{%block content%}
<div class="max-w-6xl mx-auto mt-10  rounded-lg p-8">
    <!-- Flash Messages -->
    {% if messages %}
    <div class="fixed top-5 right-5 w-1/3 z-50">
        {% for message in messages %}
        <div class="p-4 mb-4 rounded-lg bg-green-100 border-l-4 border-green-600 text-green-700">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Header Section -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold text-gray-800">Route List</h2>
        <a href="{% url 'create_route' %}" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 shadow-md">
            Add Route
        </a>
    </div>

    <!-- Route Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full table-auto bg-white rounded-lg shadow-md">
            <thead class="bg-gray-100 text-gray-600 uppercase text-sm font-semibold">
                <tr>
                    <th class="py-3 px-6 text-left">Source Station</th>
                    <th class="py-3 px-6 text-left">Destination Station</th>
                    <th class="py-3 px-6 text-left">Distance (km)</th>
                    <th class="py-3 px-6 text-left">Actions</th>
                </tr>
            </thead>
            <tbody class="text-gray-700">
                {% for route in routes %}
                <tr class="hover:bg-gray-50 border-b">
                    <td class="py-3 px-6">{{ route.sourceStation.stationName }}</td>
                    <td class="py-3 px-6">{{ route.destinationStation.stationName }}</td>
                    <td class="py-3 px-6">{{ route.distanceToDestination }}</td>
                    <td class="py-3 px-6 flex items-center space-x-4">
                        <a href="{% url 'update_route' route.id %}" class="text-blue-500 hover:underline">
                            Edit
                        </a>
                        <button
                            class="px-3 py-1 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600 focus:outline-none focus:ring"
                            onclick="confirmDelete('route', {{ route.id }})">
                            Delete
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-6 text-gray-500">No routes available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
            <h3 class="text-lg font-semibold text-gray-800">Confirm Deletion</h3>
            <p class="text-gray-600 mt-2">Are you sure you want to delete this route?</p>
            <div class="flex justify-end mt-4 space-x-4">
                <button id="cancelDelete" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                    Cancel
                </button>
                <form id="deleteForm" method="POST" action="">
                    {% csrf_token %}
                    <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function confirmDelete(routeType, routeId) {
        // Show the confirmation modal
        const modal = document.getElementById("confirmationModal");
        modal.classList.remove("hidden");

        // Set the form action dynamically
        const deleteForm = document.getElementById("deleteForm");
        deleteForm.action = `/route/delete/${routeId}/`;

        // Hide the modal on cancel
        const cancelButton = document.getElementById("cancelDelete");
        cancelButton.addEventListener("click", () => {
            modal.classList.add("hidden");
        });
    }
</script>

{%endblock%}